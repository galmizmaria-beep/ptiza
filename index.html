<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Game Editor for Genially</title>
    <style>
        :root { --primary: #00d2ff; --bg: #1a1a2d; --panel: #252540; --text: #e0e0ff; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        
        /* Header */
        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 20px; }
        h1 { margin: 0; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 15px var(--primary); }
        
        /* Layout */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: var(--panel); padding: 20px; border-radius: 10px; border: 1px solid #444; }
        .full-width { grid-column: 1 / -1; }
        
        /* Form Elements */
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #fff; }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 5px;
            border: 1px solid #555; background: #111; color: var(--primary); box-sizing: border-box;
        }
        input[type="file"] { margin-bottom: 5px; width: 100%; }
        
        /* Previews */
        .preview-box { 
            width: 100%; height: 60px; background: #111; border: 1px dashed #555; 
            margin-bottom: 15px; display: flex; align-items: center; justify-content: center; 
            background-size: contain; background-repeat: no-repeat; background-position: center;
        }
        .preview-text { font-size: 12px; color: #666; }

        /* Questions */
        .q-item { 
            background: #2f2f50; padding: 15px; margin-bottom: 10px; border-left: 4px solid var(--primary); position: relative; 
        }
        .btn-del { 
            position: absolute; top: 10px; right: 10px; background: #ff4444; color: white; border: none; cursor: pointer; padding: 5px 10px; border-radius: 3px; 
        }

        /* Buttons */
        .btn { 
            background: var(--primary); color: #000; border: none; padding: 12px 24px; 
            font-size: 16px; font-weight: bold; border-radius: 5px; cursor: pointer; width: 100%; 
            transition: 0.3s; margin-top: 10px;
        }
        .btn:hover { background: #fff; box-shadow: 0 0 20px var(--primary); }
        .btn-secondary { background: #444; color: #fff; }

        /* Output */
        #outputArea { width: 100%; height: 200px; background: #000; color: #0f0; font-family: monospace; padding: 10px; border: 1px solid #555; margin-top: 10px; }
        
        .section-title { color: var(--primary); border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 15px; margin-top: 0; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üíé Editor: Avatar Flight</h1>
        <p>–ù–∞—Å—Ç—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞–≥—Ä—É–∑–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –ø–æ–ª—É—á–∏ –∫–æ–¥ –¥–ª—è Genially.</p>
    </header>

    <div class="grid">
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="card">
            <h2 class="section-title">1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–µ—Ç–∞</h2>
            <label>–í—Ä–µ–º—è –∏–≥—Ä—ã (—Å–µ–∫—É–Ω–¥):</label>
            <input type="number" id="gTime" value="60">
            <label>–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª–µ—Ç–∞ (1-10):</label>
            <input type="number" id="gSpeed" value="6" min="1" max="15">
        </div>

        <!-- –ú–µ–¥–∏–∞ -->
        <div class="card">
            <h2 class="section-title">2. –ì—Ä–∞—Ñ–∏–∫–∞ (PNG/JPG)</h2>
            <small style="color:#aaa">–†–µ–∫–æ–º–µ–Ω–¥—É—é —Å–∂–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π!</small>
            
            <label>–§–æ–Ω –Ω–µ–±–∞:</label>
            <input type="file" id="fBg" accept="image/*" onchange="loadAsset(this, 'bg')">
            <div class="preview-box" id="p_bg"><span class="preview-text">–ù–µ—Ç —Ñ–∞–π–ª–∞</span></div>

            <label>–ü—Ç–∏—Ü–∞ (–ò–∫—Ä–∞–Ω) - –í–∏–¥ —Å–∑–∞–¥–∏:</label>
            <input type="file" id="fBird" accept="image/*" onchange="loadAsset(this, 'bird')">
            <div class="preview-box" id="p_bird"><span class="preview-text">–ù–µ—Ç —Ñ–∞–π–ª–∞</span></div>

            <label>–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ (–í—Ä–∞–≥/–°–∫–∞–ª–∞):</label>
            <input type="file" id="fObs" accept="image/*" onchange="loadAsset(this, 'obs')">
            <div class="preview-box" id="p_obs"><span class="preview-text">–ù–µ—Ç —Ñ–∞–π–ª–∞</span></div>

            <label>–ú–æ–Ω–µ—Ç–∞ (–ë–æ–Ω—É—Å —Å –≤–æ–ø—Ä–æ—Å–æ–º):</label>
            <input type="file" id="fCoin" accept="image/*" onchange="loadAsset(this, 'coin')">
            <div class="preview-box" id="p_coin"><span class="preview-text">–ù–µ—Ç —Ñ–∞–π–ª–∞</span></div>

            <label>–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ (MP3):</label>
            <input type="file" id="fMusic" accept="audio/*" onchange="loadAsset(this, 'music', false)">
            <div id="p_music" style="color: lime; font-size: 12px; display: none;">–ú—É–∑—ã–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! ‚ô™</div>
        </div>

        <!-- –í–æ–ø—Ä–æ—Å—ã -->
        <div class="card full-width">
            <h2 class="section-title">3. –ó–∞–¥–∞–Ω–∏—è (–ø—Ä—è—á—É—Ç—Å—è –≤ –º–æ–Ω–µ—Ç–∞—Ö)</h2>
            <div id="qList"></div>
            <button class="btn btn-secondary" onclick="addQ()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
        </div>

        <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <div class="card full-width" style="text-align: center;">
            <button class="btn" onclick="gen()">üöÄ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ö–û–î –ò–ì–†–´</button>
            <div id="resultBlock" style="display:none; margin-top: 20px; text-align: left;">
                <label>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Genially (Insert -> Others):</label>
                <textarea id="outputArea" readonly></textarea>
                <button class="btn btn-secondary" onclick="copyCode()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
            </div>
        </div>
    </div>
</div>

<script>
    // === –õ–û–ì–ò–ö–ê –†–ï–î–ê–ö–¢–û–†–ê ===
    const data = { bg: null, bird: null, obs: null, coin: null, music: null };

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Base64
    function loadAsset(input, key, isImg = true) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                data[key] = e.target.result;
                if(isImg) {
                    document.getElementById('p_' + key).style.backgroundImage = `url('${e.target.result}')`;
                    document.getElementById('p_' + key).innerHTML = '';
                } else {
                    document.getElementById('p_' + key).style.display = 'block';
                }
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
    function addQ() {
        const div = document.createElement('div');
        div.className = 'q-item';
        div.innerHTML = `
            <button class="btn-del" onclick="this.parentElement.remove()">x</button>
            <label>–í–æ–ø—Ä–æ—Å:</label>
            <input type="text" class="i-text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞...">
            <label>–¢–∏–ø:</label>
            <select class="i-type" onchange="toggleType(this)">
                <option value="choice">–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞</option>
                <option value="input">–í–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞</option>
            </select>
            <div class="opt-choice">
                <input type="text" class="i-corr" placeholder="–í–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç (–∑–µ–ª–µ–Ω—ã–π)" style="border-color: green;">
                <input type="text" class="i-w1" placeholder="–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç 1">
                <input type="text" class="i-w2" placeholder="–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç 2">
            </div>
            <div class="opt-input" style="display:none;">
                <input type="text" class="i-inp-corr" placeholder="–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ/—á–∏—Å–ª–æ">
            </div>
        `;
        document.getElementById('qList').appendChild(div);
    }

    function toggleType(sel) {
        const p = sel.parentElement;
        if(sel.value === 'choice') {
            p.querySelector('.opt-choice').style.display = 'block';
            p.querySelector('.opt-input').style.display = 'none';
        } else {
            p.querySelector('.opt-choice').style.display = 'none';
            p.querySelector('.opt-input').style.display = 'block';
        }
    }

    function copyCode() {
        document.getElementById('outputArea').select();
        document.execCommand('copy');
        alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Genially.');
    }

    // === –ì–ï–ù–ï–†–ê–¢–û–† –ö–û–î–ê ===
    function gen() {
        // –°–±–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤
        const qs = [];
        document.querySelectorAll('.q-item').forEach(el => {
            const type = el.querySelector('.i-type').value;
            const obj = {
                t: el.querySelector('.i-text').value,
                type: type
            };
            if(type === 'choice') {
                obj.c = el.querySelector('.i-corr').value;
                obj.w = [el.querySelector('.i-w1').value, el.querySelector('.i-w2').value];
            } else {
                obj.c = el.querySelector('.i-inp-corr').value;
            }
            qs.push(obj);
        });

        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        const cfg = {
            time: document.getElementById('gTime').value,
            speed: document.getElementById('gSpeed').value,
            qs: qs,
            img: data // base64 images
        };

        // –®–ê–ë–õ–û–ù –ò–ì–†–´ (–í–µ—Å—å –∫–æ–¥ –∏–≥—Ä—ã –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏)
        const gameCode = `
<!DOCTYPE html>
<html>
<head>
<style>
    body { margin:0; overflow:hidden; background:#000; font-family:'Verdana',sans-serif; user-select:none; }
    canvas { display:block; width:100vw; height:100vh; }
    #ui { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
    .hud { position:absolute; top:15px; color:#0ff; font-size:24px; font-weight:bold; text-shadow:2px 2px 0 #000; background:rgba(0,0,0,0.5); padding:5px 15px; border-radius:20px; border:1px solid #0ff; }
    #hud-time { left:20px; }
    #hud-score { right:20px; color:#ff0; border-color:#ff0; }
    
    .screen { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; align-items:center; justify-content:center; pointer-events:auto; z-index:99; }
    h1 { color:#0ff; font-size:40px; text-transform:uppercase; margin-bottom:20px; text-shadow:0 0 20px #0ff; text-align:center; }
    .btn { background:linear-gradient(to bottom, #0ff, #008); border:2px solid #fff; padding:15px 40px; font-size:20px; color:#fff; cursor:pointer; border-radius:50px; font-weight:bold; box-shadow:0 0 15px #0ff; transition:0.2s; text-shadow:1px 1px 0 #000; }
    .btn:hover { transform:scale(1.1); filter:brightness(1.2); }

    /* Modal */
    #modal { display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:90%; max-width:500px; background:rgba(10,20,40,0.95); border:2px solid #0ff; border-radius:15px; padding:20px; color:#fff; text-align:center; z-index:50; pointer-events:auto; box-shadow:0 0 100px rgba(0,255,255,0.2); }
    .q-opt { display:block; width:100%; padding:12px; margin:8px 0; background:#1a2a40; border:1px solid #446; color:#fff; font-size:18px; cursor:pointer; transition:0.2s; }
    .q-opt:hover { background:#0ff; color:#000; }
    input.q-inp { width:90%; padding:10px; font-size:18px; margin-bottom:10px; text-align:center; }
    
    #bar-container { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); width:300px; height:15px; background:#333; border:2px solid #fff; border-radius:10px; overflow:hidden; }
    #bar-fill { height:100%; width:0%; background:linear-gradient(90deg, #ff0, #f00); transition: width 0.3s; }
</style>
</head>
<body>

<div id="ui">
    <div id="hud-time" class="hud">‚è± <span id="val-time">0</span></div>
    <div id="hud-score" class="hud">üìÄ <span id="val-score">0</span></div>
    <div id="bar-container"><div id="bar-fill"></div></div>
</div>

<div id="start" class="screen">
    <h1>–ü–æ–ª–µ—Ç –ê–≤–∞—Ç–∞—Ä–∞</h1>
    <p style="color:#aaa; margin-bottom:30px">–£–∫–ª–æ–Ω—è–π—Å—è –æ—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π. –°–æ–±–∏—Ä–∞–π –±–æ–Ω—É—Å—ã.</p>
    <button class="btn" onclick="GM.start()">–ù–ê –°–¢–ê–†–¢</button>
</div>

<div id="end" class="screen" style="display:none">
    <h1 id="end-title"></h1>
    <p style="color:#fff; font-size:20px">–°–æ–±—Ä–∞–Ω–æ –º–æ–Ω–µ—Ç: <span id="end-score"></span></p>
    <button class="btn" onclick="location.reload()">–ó–ê–ù–û–í–û</button>
</div>

<div id="modal">
    <h2 id="q-text" style="color:#0ff"></h2>
    <div id="q-area"></div>
</div>

<canvas id="cvs"></canvas>

<script>
// === –ò–ì–†–û–í–û–ô –ö–û–î ===
const CFG = ${JSON.stringify(cfg)};
const IMG = CFG.img;
const ctx = document.getElementById('cvs').getContext('2d');
let w, h;

// –ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–¥–ª—è –∑–≤—É–∫–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)
const AC = new (window.AudioContext || window.webkitAudioContext)();
function sfx(type) {
    if(AC.state === 'suspended') AC.resume();
    const o = AC.createOscillator();
    const g = AC.createGain();
    o.connect(g); g.connect(AC.destination);
    const t = AC.currentTime;
    
    if(type==='coin') {
        o.type='sine'; o.frequency.setValueAtTime(600, t); o.frequency.linearRampToValueAtTime(1200, t+0.1);
        g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.3);
        o.start(t); o.stop(t+0.3);
    } else if (type==='hit') {
        o.type='sawtooth'; o.frequency.setValueAtTime(150, t); o.frequency.exponentialRampToValueAtTime(50, t+0.3);
        g.gain.setValueAtTime(0.2, t); g.gain.linearRampToValueAtTime(0, t+0.3);
        o.start(t); o.stop(t+0.3);
    } else if (type==='win') {
        o.type='triangle'; o.frequency.setValueAtTime(400, t); o.frequency.linearRampToValueAtTime(800, t+0.3);
        g.gain.linearRampToValueAtTime(0, t+0.6);
        o.start(t); o.stop(t+0.6);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
const iBg = new Image(); if(IMG.bg) iBg.src = IMG.bg;
const iBird = new Image(); if(IMG.bird) iBird.src = IMG.bird;
const iObs = new Image(); if(IMG.obs) iObs.src = IMG.obs;
const iCoin = new Image(); if(IMG.coin) iCoin.src = IMG.coin;
let music = null;
if(IMG.music) { music = new Audio(IMG.music); music.loop = true; music.volume = 0.4; }

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
const GM = {
    run: false, pause: false, frame: 0,
    time: parseInt(CFG.time), maxTime: parseInt(CFG.time),
    score: 0, totalQ: CFG.qs.length,
    objs: [],
    px: 0, py: 0, // Player coords
    
    resize: () => {
        w = document.getElementById('cvs').width = window.innerWidth;
        h = document.getElementById('cvs').height = window.innerHeight;
        GM.px = w/2; GM.py = h - 100;
    },
    
    start: () => {
        document.getElementById('start').style.display = 'none';
        GM.resize();
        GM.run = true;
        if(music) music.play().catch(e=>console.log(e));
        loop();
        setInterval(() => {
            if(GM.run && !GM.pause) {
                GM.time--;
                document.getElementById('val-time').innerText = GM.time;
                if(GM.time <= 0) GM.end(false);
            }
        }, 1000);
        document.getElementById('val-time').innerText = GM.time;
        // –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –º–æ–Ω–µ—Ç
        document.getElementById('bar-fill').style.width = '0%';
    },
    
    spawn: () => {
        // –®–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –º–æ–Ω–µ—Ç—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ª–∏—á–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤
        let isCoin = (CFG.qs.length > 0 && Math.random() > 0.6);
        GM.objs.push({
            x: (Math.random()-0.5) * w * 3,
            y: (Math.random()-0.5) * h * 2,
            z: 2000,
            type: isCoin ? 'coin' : 'obs'
        });
    },

    logic: () => {
        // –°–ø–∞–≤–Ω
        if(GM.frame % (60 - parseInt(CFG.speed)*3) === 0) GM.spawn();
        
        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ Z (Paint algorithm)
        GM.objs.sort((a,b) => b.z - a.z);
        
        for(let i=0; i<GM.objs.length; i++) {
            let o = GM.objs[i];
            o.z -= (10 + parseInt(CFG.speed)*2);
            
            if(o.z <= 10) { GM.objs.splice(i, 1); i--; continue; }
            
            let scale = 500 / o.z;
            let sx = w/2 + o.x * scale;
            let sy = h/2 + o.y * scale;
            let size = 120 * scale;
            
            // Draw
            let img = (o.type === 'coin') ? iCoin : iObs;
            if(img.src) ctx.drawImage(img, sx - size/2, sy - size/2, size, size);
            else {
                ctx.fillStyle = (o.type==='coin') ? 'gold' : 'red';
                ctx.fillRect(sx - size/2, sy - size/2, size, size);
            }
            
            // Collision (Hitbox)
            if(o.z < 150 && o.z > 50) {
                let d = Math.hypot(sx - GM.px, sy - GM.py);
                if(d < size/2 + 40) {
                    GM.objs.splice(i, 1); i--;
                    GM.hit(o.type);
                }
            }
        }
    },
    
    hit: (type) => {
        if(type === 'obs') {
            sfx('hit');
            ctx.fillStyle = 'rgba(255,0,0,0.5)';
            ctx.fillRect(0,0,w,h);
            GM.time -= 5;
            // Visual shake could go here
        } else {
            sfx('coin');
            GM.pause = true;
            GM.quiz();
        }
    },
    
    quiz: () => {
        if(CFG.qs.length === 0) {
            GM.score++; GM.updateUI(); GM.pause = false; return;
        }
        
        let idx = Math.floor(Math.random() * CFG.qs.length);
        let q = CFG.qs[idx];
        CFG.qs.splice(idx, 1); // –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å
        
        let m = document.getElementById('modal');
        let body = document.getElementById('q-area');
        document.getElementById('q-text').innerText = q.t;
        body.innerHTML = '';
        m.style.display = 'block';
        
        const check = (ans) => {
            m.style.display = 'none';
            if(ans.trim().toLowerCase() === q.c.trim().toLowerCase()) {
                sfx('win'); GM.score++; 
            } else {
                sfx('hit'); GM.time -= 10; alert('–ù–µ–≤–µ—Ä–Ω–æ! –®—Ç—Ä–∞—Ñ -10 —Å–µ–∫.');
            }
            GM.updateUI();
            
            if(CFG.qs.length === 0) GM.end(true);
            else GM.pause = false;
        };
        
        if(q.type === 'choice') {
            let arr = [q.c, ...q.w].sort(()=>Math.random()-0.5);
            arr.forEach(txt => {
                let b = document.createElement('button');
                b.className = 'q-opt'; b.innerText = txt;
                b.onclick = () => check(txt);
                body.appendChild(b);
            });
        } else {
            let inp = document.createElement('input'); inp.className = 'q-inp';
            let b = document.createElement('button'); b.className = 'q-opt'; b.innerText = 'OK';
            b.onclick = () => check(inp.value);
            body.appendChild(inp); body.appendChild(b);
        }
    },
    
    updateUI: () => {
        document.getElementById('val-score').innerText = GM.score;
        let pct = (GM.score / GM.totalQ) * 100;
        document.getElementById('bar-fill').style.width = pct + '%';
    },
    
    end: (win) => {
        GM.run = false;
        document.getElementById('end').style.display = 'flex';
        document.getElementById('end-score').innerText = GM.score;
        let t = document.getElementById('end-title');
        if(win) { t.innerText = "–ü–û–õ–ï–¢ –ó–ê–í–ï–†–®–ï–ù!"; t.style.color = "#0f0"; sfx('win'); }
        else { t.innerText = "–í–†–ï–ú–Ø –ò–°–¢–ï–ö–õ–û"; t.style.color = "#f00"; sfx('hit'); }
    }
};

// Input loop
window.addEventListener('resize', GM.resize);
window.addEventListener('mousemove', e => {
    GM.px = e.clientX; 
    GM.py = Math.max(e.clientY, h/2); // –ù–µ –ª–µ—Ç–µ—Ç—å —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ
});
window.addEventListener('touchmove', e => {
    e.preventDefault();
    GM.px = e.touches[0].clientX;
    GM.py = Math.max(e.touches[0].clientY, h/2);
}, {passive:false});

function loop() {
    if(!GM.run) return;
    requestAnimationFrame(loop);
    if(GM.pause) return;
    
    ctx.clearRect(0,0,w,h);
    
    // Background draw
    if(iBg.src) {
        // –ü–∞—Ä–∞–ª–ª–∞–∫—Å —ç—Ñ—Ñ–µ–∫—Ç –º–æ–∂–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ —Ä–∏—Å—É—è —Ñ–æ–Ω
        // –ù–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã Genially —Ä–∏—Å—É–µ–º –µ–≥–æ —á–µ—Ä–µ–∑ CSS cover canvas
        document.getElementById('cvs').style.background = "url('"+IMG.bg+"') center/cover";
    } else {
        ctx.fillStyle = "#000"; ctx.fillRect(0,0,w,h);
    }
    
    // Speed lines
    ctx.fillStyle = "rgba(255,255,255,0.2)";
    for(let k=0; k<10; k++) ctx.fillRect(Math.random()*w, Math.random()*h, 2, Math.random()*20);
    
    GM.logic();
    
    // Player Draw
    if(iBird.src) {
        // –õ–µ–≥–∫–∏–π –Ω–∞–∫–ª–æ–Ω
        let tilt = (GM.px - w/2) * 0.05;
        ctx.save();
        ctx.translate(GM.px, GM.py);
        ctx.rotate(tilt * Math.PI/180);
        ctx.drawImage(iBird, -75, -60, 150, 120);
        ctx.restore();
    } else {
        ctx.fillStyle = "#0ff";
        ctx.beginPath(); ctx.arc(GM.px, GM.py, 20, 0, 7); ctx.fill();
    }
    
    GM.frame++;
}
<\/script>
</body>
</html>`;

        document.getElementById('outputArea').value = gameCode;
        document.getElementById('resultBlock').style.display = 'block';
    }
</script>
</body>
</html>
