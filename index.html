<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Genially Avatar Editor (Fixed)</title>
    <style>
        body { background: #121212; color: #eee; font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #1e1e1e; padding: 20px; border-radius: 8px; }
        h1 { color: #00d2ff; text-align: center; }
        .section { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select, button { width: 100%; padding: 10px; margin-top: 5px; background: #333; color: white; border: 1px solid #444; border-radius: 4px; box-sizing: border-box;}
        button { cursor: pointer; background: #00d2ff; color: #000; font-weight: bold; }
        button:hover { background: #fff; }
        textarea { width: 100%; height: 150px; background: #000; color: #0f0; font-family: monospace; }
        .q-item { background: #2a2a2a; padding: 10px; margin-top: 10px; border-left: 3px solid #00d2ff; }
        .preview { font-size: 12px; color: #aaa; margin-top: 2px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üîß –†–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è Genially (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)</h1>
    <p style="text-align:center; color:#aaa;">–≠—Ç–∞ –≤–µ—Ä—Å–∏—è –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à–∫–æ–π –≤–Ω—É—Ç—Ä–∏ Genially.</p>

    <!-- 1. –§–∞–π–ª—ã -->
    <div class="section">
        <h3>1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
        <label>–§–æ–Ω (–ö–∞—Ä—Ç–∏–Ω–∫–∞):</label>
        <input type="file" id="bg" accept="image/*" onchange="encode(this, 'bg')">
        <div id="p_bg" class="preview">–ù–µ—Ç —Ñ–∞–π–ª–∞</div>

        <label>–ü—Ç–∏—Ü–∞ (–ò–∫—Ä–∞–Ω):</label>
        <input type="file" id="bird" accept="image/*" onchange="encode(this, 'bird')">
        <div id="p_bird" class="preview">–ù–µ—Ç —Ñ–∞–π–ª–∞</div>

        <label>–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ (–í—Ä–∞–≥):</label>
        <input type="file" id="obs" accept="image/*" onchange="encode(this, 'obs')">
        <div id="p_obs" class="preview">–ù–µ—Ç —Ñ–∞–π–ª–∞</div>

        <label>–ú–æ–Ω–µ—Ç–∞ (–í–æ–ø—Ä–æ—Å):</label>
        <input type="file" id="coin" accept="image/*" onchange="encode(this, 'coin')">
        <div id="p_coin" class="preview">–ù–µ—Ç —Ñ–∞–π–ª–∞</div>
        
        <label>–ú—É–∑—ã–∫–∞ (MP3):</label>
        <input type="file" id="music" accept="audio/*" onchange="encode(this, 'music')">
        <div id="p_music" class="preview">–ù–µ—Ç —Ñ–∞–π–ª–∞</div>
    </div>

    <!-- 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="section">
        <h3>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <label>–í—Ä–µ–º—è (—Å–µ–∫):</label> <input type="number" id="time" value="60">
        <label>–°–∫–æ—Ä–æ—Å—Ç—å (1-10):</label> <input type="number" id="speed" value="6">
    </div>

    <!-- 3. –í–æ–ø—Ä–æ—Å—ã -->
    <div class="section">
        <h3>3. –í–æ–ø—Ä–æ—Å—ã</h3>
        <div id="qList"></div>
        <button onclick="addQ()" style="background:#444; margin-top:10px;">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
    </div>

    <!-- 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
    <div class="section">
        <button onclick="generate()">üöÄ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ö–û–î</button>
        <label>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Genially (Insert -> Others):</label>
        <textarea id="output" readonly></textarea>
        <button onclick="copy()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
    </div>
</div>

<script>
    const assets = { bg: "", bird: "", obs: "", coin: "", music: "" };

    function encode(input, key) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                assets[key] = e.target.result;
                document.getElementById('p_' + key).innerText = "–ó–∞–≥—Ä—É–∂–µ–Ω–æ! (" + Math.round(e.target.result.length/1024) + " KB)";
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function addQ() {
        const div = document.createElement('div');
        div.className = 'q-item';
        div.innerHTML = `
            <input type="text" class="q-text" placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞">
            <select class="q-type" onchange="this.nextElementSibling.style.display=this.value=='choice'?'block':'none'; this.nextElementSibling.nextElementSibling.style.display=this.value=='input'?'block':'none'">
                <option value="choice">–í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞</option>
                <option value="input">–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞</option>
            </select>
            <div class="opt-c">
                <input type="text" class="c-ans" placeholder="–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç" style="border-color:green">
                <input type="text" class="w-ans1" placeholder="–ù–µ–≤–µ—Ä–Ω—ã–π 1">
                <input type="text" class="w-ans2" placeholder="–ù–µ–≤–µ—Ä–Ω—ã–π 2">
            </div>
            <div class="opt-i" style="display:none">
                <input type="text" class="i-ans" placeholder="–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç">
            </div>
            <button onclick="this.parentElement.remove()" style="background:red; margin-top:5px; padding:5px;">–£–¥–∞–ª–∏—Ç—å</button>
        `;
        document.getElementById('qList').appendChild(div);
    }

    function copy() {
        document.getElementById('output').select();
        document.execCommand('copy');
        alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
    }

    function generate() {
        const qs = [];
        document.querySelectorAll('.q-item').forEach(el => {
            const type = el.querySelector('.q-type').value;
            const obj = { t: el.querySelector('.q-text').value, type: type };
            if (type === 'choice') {
                obj.c = el.querySelector('.c-ans').value;
                obj.w = [el.querySelector('.w-ans1').value, el.querySelector('.w-ans2').value];
            } else {
                obj.c = el.querySelector('.i-ans').value;
            }
            qs.push(obj);
        });

        const cfg = {
            t: document.getElementById('time').value,
            s: document.getElementById('speed').value,
            q: qs,
            img: assets
        };

        const code = `
<!DOCTYPE html>
<html>
<head>
<style>
    body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; font-family:Arial, sans-serif; }
    #game-container { position:relative; width:100%; height:100%; }
    canvas { display:block; width:100%; height:100%; }
    
    /* UI —Å–ª–æ–∏ */
    .ui-layer { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index: 10; }
    .hud-text { font-size:20px; font-weight:bold; color:#0ff; text-shadow:1px 1px 0 #000; position:absolute; top:10px; }
    
    /* –≠–∫—Ä–∞–Ω—ã (–°—Ç–∞—Ä—Ç/–ö–æ–Ω–µ—Ü) */
    .screen { 
        position:absolute; top:0; left:0; width:100%; height:100%; 
        background:rgba(0,0,0,0.85); z-index: 20;
        display:flex; flex-direction:column; align-items:center; justify-content:center;
    }
    
    h1 { color:#00d2ff; text-align:center; margin-bottom:20px; font-size: 32px; text-transform:uppercase; text-shadow: 0 0 20px #00d2ff; }
    
    .btn { 
        background: #00d2ff; color: #000; border: 2px solid #fff; 
        padding: 15px 40px; font-size: 24px; font-weight: bold; cursor: pointer; 
        border-radius: 50px; text-transform:uppercase; box-shadow: 0 0 15px #00d2ff;
        pointer-events: auto; /* –í–∞–∂–Ω–æ –¥–ª—è –∫–ª–∏–∫–∞ */
        transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.95); background: #fff; }

    /* –û–∫–Ω–æ –≤–æ–ø—Ä–æ—Å–∞ */
    #q-modal { 
        display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); 
        width:90%; max-width:400px; background:#1a2a40; border:2px solid #00d2ff; 
        padding:15px; text-align:center; z-index:30; border-radius:10px; pointer-events:auto;
    }
    .q-btn { display:block; width:100%; padding:10px; margin:5px 0; background:#000; color:#fff; border:1px solid #555; cursor:pointer; font-size:16px; }
    .q-btn:hover { background:#00d2ff; color:#000; }
    input.q-inp { width:90%; padding:10px; font-size:18px; text-align:center; margin-bottom:10px; }

</style>
</head>
<body>

<div id="game-container">
    <canvas id="cvs"></canvas>
    
    <div class="ui-layer">
        <div class="hud-text" style="left:10px">‚è≥ <span id="ui-time">0</span></div>
        <div class="hud-text" style="right:10px">üìÄ <span id="ui-score">0</span></div>
    </div>

    <div id="start-screen" class="screen">
        <h1>–ü–æ–ª–µ—Ç –ê–≤–∞—Ç–∞—Ä–∞</h1>
        <button class="btn" id="start-btn">–ù–ê–ß–ê–¢–¨ –ü–û–õ–ï–¢</button>
    </div>

    <div id="end-screen" class="screen" style="display:none">
        <h1 id="end-title"></h1>
        <p style="color:#fff; font-size:18px">–°–æ–±—Ä–∞–Ω–æ: <span id="end-score">0</span></p>
        <button class="btn" onclick="location.reload()">–ó–ê–ù–û–í–û</button>
    </div>

    <div id="q-modal">
        <h3 id="q-text" style="color:#0ff; margin-top:0"></h3>
        <div id="q-opts"></div>
    </div>
</div>

<script>
// –î–ê–ù–ù–´–ï –ò–ó –†–ï–î–ê–ö–¢–û–†–ê
const CFG = ${JSON.stringify(cfg)};
const IMG = CFG.img;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Canvas
const cvs = document.getElementById('cvs');
const ctx = cvs.getContext('2d');
let W, H;

// –†–µ—Å—É—Ä—Å—ã
const iBg = new Image(); if(IMG.bg) iBg.src = IMG.bg;
const iBird = new Image(); if(IMG.bird) iBird.src = IMG.bird;
const iObs = new Image(); if(IMG.obs) iObs.src = IMG.obs;
const iCoin = new Image(); if(IMG.coin) iCoin.src = IMG.coin;
let music = null; if(IMG.music) { music = new Audio(IMG.music); music.loop = true; music.volume=0.5; }

// –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–±–µ–∑ —Ñ–∞–π–ª–æ–≤)
const AC = new (window.AudioContext || window.webkitAudioContext)();
function beep(type) {
    if(AC.state==='suspended') AC.resume();
    const o = AC.createOscillator(); const g = AC.createGain();
    o.connect(g); g.connect(AC.destination);
    const t = AC.currentTime;
    if(type==='win') { 
        o.frequency.setValueAtTime(500,t); o.frequency.linearRampToValueAtTime(1000,t+0.2); 
        g.gain.setValueAtTime(0.1,t); g.gain.linearRampToValueAtTime(0,t+0.5);
    } else { 
        o.type='sawtooth'; o.frequency.setValueAtTime(200,t); o.frequency.exponentialRampToValueAtTime(50,t+0.3);
        g.gain.setValueAtTime(0.1,t); g.gain.linearRampToValueAtTime(0,t+0.3);
    }
    o.start(t); o.stop(t+0.5);
}

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
const G = {
    run: false, pause: false, frame: 0,
    time: parseInt(CFG.t), score: 0,
    objs: [],
    mx: 0, my: 0, // –ú—ã—à—å
    
    resize: () => {
        // –í–∞–∂–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Genially: –±–µ—Ä–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        W = cvs.width = document.body.clientWidth;
        H = cvs.height = document.body.clientHeight;
        G.mx = W/2; G.my = H-100;
    },
    
    start: () => {
        document.getElementById('start-screen').style.display = 'none';
        G.resize();
        if(music) music.play().catch(e=>console.log(e));
        G.run = true;
        loop();
        setInterval(() => {
            if(G.run && !G.pause) {
                G.time--;
                document.getElementById('ui-time').innerText = G.time;
                if(G.time <= 0) G.end(false);
            }
        }, 1000);
        document.getElementById('ui-time').innerText = G.time;
    },
    
    end: (win) => {
        G.run = false;
        document.getElementById('end-screen').style.display = 'flex';
        document.getElementById('end-score').innerText = G.score;
        let t = document.getElementById('end-title');
        t.innerText = win ? "–ü–û–ë–ï–î–ê!" : "–í–†–ï–ú–Ø –í–´–®–õ–û";
        t.style.color = win ? "#0f0" : "#f00";
        beep(win ? 'win' : 'lose');
    }
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –°–¢–ê–†–¢
document.getElementById('start-btn').addEventListener('click', G.start);

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ú–´–®–¨–Æ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è iFrame)
window.addEventListener('mousemove', e => {
    const rect = cvs.getBoundingClientRect();
    G.mx = e.clientX - rect.left;
    G.my = e.clientY - rect.top;
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ —É–ª–µ—Ç–∞–ª –≤–≤–µ—Ä—Ö
    if(G.my < H/2) G.my = H/2;
});
window.addEventListener('resize', G.resize);

// –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
function loop() {
    if(!G.run) return;
    requestAnimationFrame(loop);
    if(G.pause) return;

    ctx.clearRect(0,0,W,H);
    
    // 1. –§–æ–Ω
    if(iBg.src) {
        // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º —Ñ–æ–Ω –∫–∞–∫ cover
        let scale = Math.max(W/iBg.width, H/iBg.height);
        let bw = iBg.width*scale; let bh = iBg.height*scale;
        ctx.drawImage(iBg, (W-bw)/2, (H-bh)/2, bw, bh);
    } else {
        ctx.fillStyle="#111"; ctx.fillRect(0,0,W,H);
    }
    
    // 2. –õ–∏–Ω–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
    ctx.fillStyle="rgba(255,255,255,0.3)";
    for(let i=0; i<5; i++) ctx.fillRect(Math.random()*W, Math.random()*H, 2, Math.random()*30);
    
    // 3. –°–ø–∞–≤–Ω –æ–±—ä–µ–∫—Ç–æ–≤
    if(G.frame % (60 - parseInt(CFG.s)*3) === 0) {
        let isCoin = (CFG.q.length > 0 && Math.random() > 0.6);
        G.objs.push({ x: (Math.random()-0.5)*W*2, y: (Math.random()-0.5)*H*1.5, z: 2000, type: isCoin?'coin':'obs' });
    }
    
    // 4. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
    G.objs.sort((a,b)=>b.z-a.z);
    for(let i=0; i<G.objs.length; i++) {
        let o = G.objs[i];
        o.z -= (10 + parseInt(CFG.s)*2);
        
        if(o.z < 10) { G.objs.splice(i,1); i--; continue; }
        
        let scale = 500/o.z;
        let sx = W/2 + o.x*scale;
        let sy = H/2 + o.y*scale;
        let size = 100*scale;
        
        let img = (o.type==='coin') ? iCoin : iObs;
        if(img.src) ctx.drawImage(img, sx-size/2, sy-size/2, size, size);
        else {
            ctx.fillStyle = (o.type==='coin') ? 'gold' : 'red';
            ctx.fillRect(sx-size/2, sy-size/2, size, size);
        }
        
        // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ
        if(o.z < 150 && o.z > 50) {
            let dist = Math.hypot(sx - G.mx, sy - G.my);
            if(dist < size/2 + 40) {
                G.objs.splice(i,1); i--;
                hit(o.type);
            }
        }
    }
    
    // 5. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ò–≥—Ä–æ–∫–∞
    if(iBird.src) {
        ctx.drawImage(iBird, G.mx-60, G.my-60, 120, 120);
    } else {
        ctx.fillStyle = "#0ff";
        ctx.beginPath(); ctx.arc(G.mx, G.my, 20, 0, 7); ctx.fill();
    }
    
    G.frame++;
}

function hit(type) {
    if(type==='obs') {
        beep('lose');
        ctx.fillStyle="rgba(255,0,0,0.5)"; ctx.fillRect(0,0,W,H);
        G.time -= 5;
    } else {
        beep('win');
        G.pause = true;
        showQ();
    }
}

function showQ() {
    if(CFG.q.length === 0) {
        G.score++; document.getElementById('ui-score').innerText = G.score; G.pause=false; return;
    }
    let idx = Math.floor(Math.random()*CFG.q.length);
    let q = CFG.q[idx];
    CFG.q.splice(idx,1); // –£–¥–∞–ª–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
    
    let m = document.getElementById('q-modal');
    let div = document.getElementById('q-opts');
    document.getElementById('q-text').innerText = q.t;
    div.innerHTML = '';
    m.style.display = 'block';
    
    const ans = (txt) => {
        m.style.display = 'none';
        if(txt.toLowerCase().trim() === q.c.toLowerCase().trim()) {
            beep('win'); G.score++; 
        } else {
            beep('lose'); G.time -= 10; alert("–û—à–∏–±–∫–∞! -10 —Å–µ–∫");
        }
        document.getElementById('ui-score').innerText = G.score;
        if(CFG.q.length===0) G.end(true);
        else G.pause = false;
    };
    
    if(q.type === 'choice') {
        let arr = [q.c, ...q.w].sort(()=>Math.random()-0.5);
        arr.forEach(t => {
            let b = document.createElement('button'); b.className='q-btn'; b.innerText=t;
            b.onclick = () => ans(t);
            div.appendChild(b);
        });
    } else {
        let inp = document.createElement('input'); inp.className='q-inp';
        let b = document.createElement('button'); b.className='q-btn'; b.innerText='OK';
        b.onclick = () => ans(inp.value);
        div.appendChild(inp); div.appendChild(b);
    }
}
<\/script>
</body>
</html>`;
        
        document.getElementById('output').value = code;
    }
</script>
</body>
</html>
